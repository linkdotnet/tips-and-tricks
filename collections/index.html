
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A collection of tips and tricks with smaller code snippets and explanation.">
      
      
      
        <link rel="canonical" href="https://linkdotnet.github.io/tips-and-tricks/collections/">
      
      
        <link rel="prev" href="../blazor/">
      
      
        <link rel="next" href="../debugging/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.6">
    
    
      
        <title>Collections - Tips and tricks</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.558e4712.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Sora:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Sora";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#collections" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Tips and tricks" class="md-header__button md-logo" aria-label="Tips and tricks" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Tips and tricks
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Collections
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/linkdotnet/tips-and-tricks" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    linkdotnet/tips-and-tricks
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Tips and tricks" class="md-nav__button md-logo" aria-label="Tips and tricks" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Tips and tricks
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/linkdotnet/tips-and-tricks" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    linkdotnet/tips-and-tricks
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../array/" class="md-nav__link">
        Array
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../async_await/" class="md-nav__link">
        Async / Await
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../blazor/" class="md-nav__link">
        Blazor
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Collections
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Collections
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#passing-collections-as-a-method-parameter" class="md-nav__link">
    Passing collections as a method parameter
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#possible-multiple-enumeration-with-ienumerablet" class="md-nav__link">
    Possible multiple enumeration with IEnumerable&lt;T&gt;
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#returning-null-for-ienumerablet" class="md-nav__link">
    Returning null for IEnumerable&lt;T&gt;
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consider-ireadonlycollectiont-if-you-always-return-an-in-memory-list" class="md-nav__link">
    Consider IReadOnlyCollection&lt;T&gt; if you always return an in memory list
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dont-use-zero-length-arrays" class="md-nav__link">
    Don't use zero-length arrays
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#specify-capacity-of-collections" class="md-nav__link">
    Specify capacity of collections
  </a>
  
    <nav class="md-nav" aria-label="Specify capacity of collections">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#benchmark" class="md-nav__link">
    Benchmark
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-hashset-to-avoid-linear-searches" class="md-nav__link">
    Use HashSet to avoid linear searches
  </a>
  
    <nav class="md-nav" aria-label="Use HashSet to avoid linear searches">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#benchmark_1" class="md-nav__link">
    Benchmark
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-hashset-for-set-based-operations-like-finding-the-intersection-of-two-collections" class="md-nav__link">
    Use HashSet for set based operations like finding the intersection of two collections
  </a>
  
    <nav class="md-nav" aria-label="Use HashSet for set based operations like finding the intersection of two collections">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#benchmark_2" class="md-nav__link">
    Benchmark
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-arraysegmentt-for-efficient-slicing-of-arrays" class="md-nav__link">
    Use ArraySegment&lt;T&gt; for efficient slicing of arrays
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../debugging/" class="md-nav__link">
        Debugging
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../dictionary/" class="md-nav__link">
        Dictionary
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../exceptions/" class="md-nav__link">
        Exceptions
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../linq/" class="md-nav__link">
        LINQ
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../misc/" class="md-nav__link">
        Misc
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../strings/" class="md-nav__link">
        Strings
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../valuetuple/" class="md-nav__link">
        ValueTuple
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_12" type="checkbox" id="__nav_12" >
      
      
      
        <label class="md-nav__link" for="__nav_12" tabindex="0" aria-expanded="false">
          Advanced
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Advanced" data-md-level="1">
        <label class="md-nav__title" for="__nav_12">
          <span class="md-nav__icon md-icon"></span>
          Advanced
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/" class="md-nav__link">
        Advanced
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/arraypool/" class="md-nav__link">
        ArrayPools to minimize allocations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/boxing/" class="md-nav__link">
        Boxing/Unboxing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/iterate_list/" class="md-nav__link">
        Iterate through a List<T>
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/lambda_methodgroup/" class="md-nav__link">
        Lambda vs method group
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/lazy/" class="md-nav__link">
        Lazy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/SIMD/" class="md-nav__link">
        SIMD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/span/" class="md-nav__link">
        Span
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/stackalloc/" class="md-nav__link">
        stackalloc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/struct/" class="md-nav__link">
        struct
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_13" type="checkbox" id="__nav_13" >
      
      
      
        <label class="md-nav__link" for="__nav_13" tabindex="0" aria-expanded="false">
          EF Core
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="EF Core" data-md-level="1">
        <label class="md-nav__title" for="__nav_13">
          <span class="md-nav__icon md-icon"></span>
          EF Core
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../efcore/" class="md-nav__link">
        EF Core
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../efcore/detailed_logging/" class="md-nav__link">
        Detailed Logging
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../efcore/asnotracking/" class="md-nav__link">
        Don't track readonly entities
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../efcore/maxlength_strings/" class="md-nav__link">
        Define maximum length for strings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../efcore/loadasync/" class="md-nav__link">
        LoadAsync
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../efcore/in_memory_sqlite/" class="md-nav__link">
        In Memory database with SQLite
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../efcore/retry/" class="md-nav__link">
        Retry on failure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../efcore/splitquery/" class="md-nav__link">
        SplitQuery
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_14" type="checkbox" id="__nav_14" >
      
      
      
        <label class="md-nav__link" for="__nav_14" tabindex="0" aria-expanded="false">
          Logging
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Logging" data-md-level="1">
        <label class="md-nav__title" for="__nav_14">
          <span class="md-nav__icon md-icon"></span>
          Logging
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../logging/" class="md-nav__link">
        Logging
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../logging/compiletime_logging/" class="md-nav__link">
        Compile-time logging source generator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../logging/string_interpolation/" class="md-nav__link">
        Don't use string interpolation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_15" type="checkbox" id="__nav_15" >
      
      
      
        <label class="md-nav__link" for="__nav_15" tabindex="0" aria-expanded="false">
          NuGet
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="NuGet" data-md-level="1">
        <label class="md-nav__title" for="__nav_15">
          <span class="md-nav__icon md-icon"></span>
          NuGet
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../nuget/" class="md-nav__link">
        NuGet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../nuget/floating_versioning/" class="md-nav__link">
        Use floating versioning
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_16" type="checkbox" id="__nav_16" >
      
      
      
        <label class="md-nav__link" for="__nav_16" tabindex="0" aria-expanded="false">
          Regular Expressions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Regular Expressions" data-md-level="1">
        <label class="md-nav__title" for="__nav_16">
          <span class="md-nav__icon md-icon"></span>
          Regular Expressions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../regex/" class="md-nav__link">
        Regular Expressions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../regex/regex_options/" class="md-nav__link">
        RegExOptions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../regex/right_to_left/" class="md-nav__link">
        Right to left search
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../regex/source_generator/" class="md-nav__link">
        Source Code Generators
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#passing-collections-as-a-method-parameter" class="md-nav__link">
    Passing collections as a method parameter
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#possible-multiple-enumeration-with-ienumerablet" class="md-nav__link">
    Possible multiple enumeration with IEnumerable&lt;T&gt;
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#returning-null-for-ienumerablet" class="md-nav__link">
    Returning null for IEnumerable&lt;T&gt;
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consider-ireadonlycollectiont-if-you-always-return-an-in-memory-list" class="md-nav__link">
    Consider IReadOnlyCollection&lt;T&gt; if you always return an in memory list
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dont-use-zero-length-arrays" class="md-nav__link">
    Don't use zero-length arrays
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#specify-capacity-of-collections" class="md-nav__link">
    Specify capacity of collections
  </a>
  
    <nav class="md-nav" aria-label="Specify capacity of collections">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#benchmark" class="md-nav__link">
    Benchmark
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-hashset-to-avoid-linear-searches" class="md-nav__link">
    Use HashSet to avoid linear searches
  </a>
  
    <nav class="md-nav" aria-label="Use HashSet to avoid linear searches">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#benchmark_1" class="md-nav__link">
    Benchmark
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-hashset-for-set-based-operations-like-finding-the-intersection-of-two-collections" class="md-nav__link">
    Use HashSet for set based operations like finding the intersection of two collections
  </a>
  
    <nav class="md-nav" aria-label="Use HashSet for set based operations like finding the intersection of two collections">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#benchmark_2" class="md-nav__link">
    Benchmark
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-arraysegmentt-for-efficient-slicing-of-arrays" class="md-nav__link">
    Use ArraySegment&lt;T&gt; for efficient slicing of arrays
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  



<h1 id="collections">Collections<a class="headerlink" href="#collections" title="Permanent link">&para;</a></h1>
<p>This chapter looks closer to collections and its best practices.</p>
<h2 id="passing-collections-as-a-method-parameter">Passing collections as a method parameter<a class="headerlink" href="#passing-collections-as-a-method-parameter" title="Permanent link">&para;</a></h2>
<p>If your method needs to accept a collection as a parameter, then generally <code>IEnumerable&lt;T&gt;</code> is ok and this offers the most flexibility to the caller. It doesn&rsquo;t matter what concrete collection type they use, and it even allows them to pass lazily evaluated sequences in, This is a <code>general</code> approach and for preventing multiple enumeration we can call <code>ToList()</code> in first of executing method or we can use <code>IReadOnlyCollection&lt;T&gt;</code> or <code>IReadOnlyList</code> for preventing multiple enumeration.</p>
<p>❌ <strong>Bad</strong> using <code>IEnumerable&lt;T&gt;</code> generally as input collection type is ok, but without using <code>ToList()</code> in first of executing could create multiple enumeration.
<div class="highlight"><pre><span></span><code><span class="k">void</span><span class="w"> </span><span class="nf">PrintProducts</span><span class="p">(</span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="n">products</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// First Enumeration.</span>
<span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">$&quot;Product Count is: {products.Count()}.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Second Enumeration.</span>
<span class="w">    </span><span class="k">foreach</span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">product</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">products</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">$&quot;Id: {product.Id} - Title: {product.Title}&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">void</span><span class="w"> </span><span class="nf">Caller</span><span class="p">()</span><span class="w"> </span>
<span class="p">{</span>
<span class="w">    </span><span class="n">PrintProducts</span><span class="p">(</span><span class="n">products</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">Title</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;IPhone&quot;</span><span class="p">));</span><span class="w"> </span>
<span class="p">}</span>
</code></pre></div></p>
<p>✅ <strong>Good</strong> With using <code>IReadOnlyCollection&lt;T&gt;</code> in our parameter specifically, we can prevent unexpected behaviors and multiple enumerations.
<div class="highlight"><pre><span></span><code><span class="k">void</span><span class="w"> </span><span class="nf">PrintProducts</span><span class="p">(</span><span class="n">IReadOnlyCollection</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="n">products</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">$&quot;Product Count is: {products.Count}.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="k">foreach</span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">product</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">products</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">$&quot;Id: {product.Id} - Title: {product.Title}&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">void</span><span class="w"> </span><span class="nf">Caller</span><span class="p">()</span><span class="w"> </span>
<span class="p">{</span>
<span class="w">    </span><span class="n">PrintProducts</span><span class="p">(</span><span class="n">products</span><span class="p">.</span><span class="k">where</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">Title</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;IPhone&quot;</span><span class="p">).</span><span class="n">AsReadOnly</span><span class="p">());</span><span class="w"> </span>
<span class="p">}</span>
</code></pre></div></p>
<p>✅ <strong>Good</strong> With using <code>IEnumerable&lt;T&gt;</code> in our parameter specifically and calling <code>ToList()</code> in first line of executing, we can prevent unexpected behaviors and multiple enumerations.
<div class="highlight"><pre><span></span><code><span class="k">void</span><span class="w"> </span><span class="nf">PrintProducts</span><span class="p">(</span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="n">products</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">products</span><span class="p">.</span><span class="n">ToList</span><span class="p">();</span>

<span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">$&quot;Product Count is: {items.Count}.&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="k">foreach</span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">product</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">items</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">$&quot;Id: {product.Id} - Title: {product.Title}&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">void</span><span class="w"> </span><span class="nf">Caller</span><span class="p">()</span><span class="w"> </span>
<span class="p">{</span>
<span class="w">    </span><span class="n">PrintProducts</span><span class="p">(</span><span class="n">products</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">Title</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;IPhone&quot;</span><span class="p">));</span><span class="w"> </span>
<span class="p">}</span>
</code></pre></div></p>
<h2 id="possible-multiple-enumeration-with-ienumerablet">Possible multiple enumeration with <code>IEnumerable&lt;T&gt;</code><a class="headerlink" href="#possible-multiple-enumeration-with-ienumerablet" title="Permanent link">&para;</a></h2>
<p>As <code>IEnumerable&lt;T&gt;</code> is not a materialized collection but more cursor on the current element of the enumeration, using multiple functions on <code>IEnumerable&lt;T&gt;</code> can lead to possible multiple enumerations.
This becomes a penalty when retrieving the content is expensive as the work is done multiple times, for example it could be an expensive operation that goes to a database multiple time with each enumeration, or it could even return different results in each enumeration.</p>
<p>❌ <strong>Bad</strong> Will enumerate the enumeration twice
<div class="highlight"><pre><span></span><code><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">integers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetIntegers</span><span class="p">();</span>
<span class="kt">var</span><span class="w"> </span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">integers</span><span class="p">.</span><span class="n">Min</span><span class="p">();</span>
<span class="kt">var</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">integers</span><span class="p">.</span><span class="n">Max</span><span class="p">();</span>

<span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="s">$&quot;Min: {min} / Max: {max}&quot;</span><span class="p">);</span>

<span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GetIntegers</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Getting integer&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Will output:</p>
<blockquote>
<p>Getting integer<br />
Getting integer<br />
Min: 1 / Max: 2</p>
</blockquote>
<p>✅ <strong>Good</strong> Enumeration get materialized once via <code>ToList</code>
<div class="highlight"><pre><span></span><code><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">integers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetIntegers</span><span class="p">();</span>
<span class="kt">var</span><span class="w"> </span><span class="n">integerList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">integers</span><span class="p">.</span><span class="n">ToList</span><span class="p">();</span>
<span class="kt">var</span><span class="w"> </span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">integerList</span><span class="p">.</span><span class="n">Min</span><span class="p">();</span>
<span class="kt">var</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">integerList</span><span class="p">.</span><span class="n">Max</span><span class="p">();</span>

<span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="s">$&quot;Min: {min} / Max: {max}&quot;</span><span class="p">);</span>

<span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GetIntegers</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Getting integer&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Will output:</p>
<blockquote>
<p>Getting integer<br />
Min: 1 / Max: 2</p>
</blockquote>
<h2 id="returning-null-for-ienumerablet">Returning null for <code>IEnumerable&lt;T&gt;</code><a class="headerlink" href="#returning-null-for-ienumerablet" title="Permanent link">&para;</a></h2>
<p>A lot of <strong>LINQ</strong> operations are built upon the premise that <code>IEnumerable&lt;T&gt;</code>, even though it is a reference type, should not be <code>null</code> at any given time.</p>
<p>❌ <strong>Bad</strong> Instead of an empty enumeration a <code>null</code> will be returned which can confuse a consumer.
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="n">MyDto</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GetAll</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(...)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div></p>
<p>✅ <strong>Good</strong> Instead return an empty enumeration.
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="n">MyDto</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GetAll</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(...)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Enumerable</span><span class="p">.</span><span class="n">Empty</span><span class="o">&lt;</span><span class="n">MyDto</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div></p>
<h2 id="consider-ireadonlycollectiont-if-you-always-return-an-in-memory-list">Consider <code>IReadOnlyCollection&lt;T&gt;</code> if you always return an in memory list<a class="headerlink" href="#consider-ireadonlycollectiont-if-you-always-return-an-in-memory-list" title="Permanent link">&para;</a></h2>
<p>Many developers assume that <code>IEnumerable</code> is the best type to return a collection from a method. It&rsquo;s not a bad choice, but it does mean that the caller cannot make any assumptions about the collection they have been given, If enumerating the return value will be an in-memory operation or a potentially expensive action. They also don&rsquo;t know if they can safely enumerate it more than once. So often the caller ends up doing a <code>.ToList()</code> or similar on the collection you passed, which is wasteful if it was already a <code>List&lt;T&gt;</code> already. This is actually another case in which <code>IReadOnlyCollection&lt;T&gt;</code> can be a good fit if you know your method is always going to return an <code>in-memory collection</code>.</p>
<p>So It gives your caller the ability to access the count of items and iterate through as many times as they like.</p>
<p>❌ <strong>Bad</strong> With returning <code>IEnumerable&lt;Product&gt;</code>, We don&rsquo;t know the result is an in-memory operation or a potentially expensive action so It can be a risky operation with multiple enumeration.
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GetAllProducts</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></p>
<p>✅ <strong>Good</strong> If we are sure, our result is a in-memory collection it is better we return a <code>IReadOnlyCollection&lt;Product&gt;</code> instead of <code>IEnumerable&lt;Product&gt;</code>.
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="n">IReadOnlyCollection</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GetAllProducts</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></p>
<h2 id="dont-use-zero-length-arrays">Don&rsquo;t use zero-length arrays<a class="headerlink" href="#dont-use-zero-length-arrays" title="Permanent link">&para;</a></h2>
<p>When initializing a zero-length array unnecessary memory allocation have to be made. Using <code>Array.Empty</code> can increase readability and reduce memory consumption as the memory is shared across all invocations of the method.</p>
<p>❌ <strong>Bad</strong> Return zero-initialized array.
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="nf">MyFunc</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">input</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">input</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></p>
<p>✅ <strong>Good</strong> Use <code>Array.Empty&lt;int&gt;</code> to increase readability and less allocations.
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="nf">MyFunc</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">input</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">input</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Array</span><span class="p">.</span><span class="n">Empty</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></p>
<blockquote>
<p>💡 Info: For every generic version of <code>Array.Empty&lt;T&gt;</code> the instance and memory is shared.
<div class="highlight"><pre><span></span><code><span class="n">ReferenceEquals</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="m">0</span><span class="p">],</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span><span class="w"> </span><span class="c1">// Is false</span>
<span class="n">ReferenceEquals</span><span class="p">(</span><span class="n">Array</span><span class="p">.</span><span class="n">Empty</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(),</span><span class="w"> </span><span class="n">Array</span><span class="p">.</span><span class="n">Empty</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">());</span><span class="w"> </span><span class="c1">// Is true</span>
<span class="n">ReferenceEquals</span><span class="p">(</span><span class="n">Array</span><span class="p">.</span><span class="n">Empty</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(),</span><span class="w"> </span><span class="n">Array</span><span class="p">.</span><span class="n">Empty</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">());</span><span class="w"> </span><span class="c1">// Is false</span>
</code></pre></div></p>
</blockquote>
<h2 id="specify-capacity-of-collections">Specify capacity of collections<a class="headerlink" href="#specify-capacity-of-collections" title="Permanent link">&para;</a></h2>
<p>Often times collections like <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.list-1.-ctor?view=net-6.0#system-collections-generic-list-1-ctor(system-int32)"><code>List&lt;T&gt;</code></a> offer constructors, which give the option to pass in the expected capacity of the list.
The <code>DefaultCapacity</code> of a list is <strong>4</strong>. If added another item it will grow by the factor of 2. As the underlying structure of a <code>List&lt;T&gt;</code> is a conventional array and arrays can&rsquo;t shrink or grow in size, a new array has to be created with the new size plus the content of the old array. This takes times and needs to unnecessary allocations. This is especially important for hot paths.</p>
<p>❌ <strong>Bad</strong> No capacity is given so the internal array has to be resized often.
<div class="highlight"><pre><span></span><code><span class="kt">var</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">();</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">20</span><span class="n">_000</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="n">numbers</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</code></pre></div></p>
<p>✅ <strong>Good</strong> Capacity is given and the internal array of the <code>List&lt;T&gt;</code> has the correct size.
<div class="highlight"><pre><span></span><code><span class="kt">var</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="m">20</span><span class="n">_000</span><span class="p">);</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">20</span><span class="n">_000</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="n">numbers</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</code></pre></div></p>
<h3 id="benchmark">Benchmark<a class="headerlink" href="#benchmark" title="Permanent link">&para;</a></h3>
<p>Result of the given example above:
<div class="highlight"><pre><span></span><code><span class="o">|</span><span class="w">              </span><span class="n">Method</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="n">Mean</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="n">Error</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="n">StdDev</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Ratio</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">RatioSD</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="n">Gen</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="n">Gen</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="n">Gen</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Allocated</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Alloc</span><span class="w"> </span><span class="n">Ratio</span><span class="w"> </span><span class="o">|</span>
<span class="o">|--------------------</span><span class="w"> </span><span class="o">|----------</span><span class="p">:</span><span class="o">|---------</span><span class="p">:</span><span class="o">|---------</span><span class="p">:</span><span class="o">|------</span><span class="p">:</span><span class="o">|--------</span><span class="p">:</span><span class="o">|--------</span><span class="p">:</span><span class="o">|--------</span><span class="p">:</span><span class="o">|--------</span><span class="p">:</span><span class="o">|----------</span><span class="p">:</span><span class="o">|------------</span><span class="p">:</span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">ListWithoutCapacity</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">102.64</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">1.999</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">3.340</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="m">1.00</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="m">0.00</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">41.6260</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">41.6260</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">41.6260</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">256.36</span><span class="w"> </span><span class="n">KB</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="m">1.00</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="n">ListWithCapacity</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="m">39.55</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">0.789</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">1.698</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="m">0.38</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="m">0.02</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">18.8599</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="o">-</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="o">-</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="m">78.18</span><span class="w"> </span><span class="n">KB</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="m">0.30</span><span class="w"> </span><span class="o">|</span>
</code></pre></div></p>
<h2 id="use-hashset-to-avoid-linear-searches">Use <code>HashSet</code> to avoid linear searches<a class="headerlink" href="#use-hashset-to-avoid-linear-searches" title="Permanent link">&para;</a></h2>
<p>If a collection is used often times to check whether or not an item is present a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.hashset-1?view=net-6.0"><code>HashSet</code></a> might be a better option than a <code>List&lt;T&gt;</code>. The initial cost to create a <code>HashSet</code> is more expensive than a <code>List&lt;T&gt;</code> but set-based operations are faster. In this case this holds true even for <a href="https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.any?view=net-6.0"><code>Any</code></a>, which is basically a linear search through the array.</p>
<p>❌ <strong>Bad</strong> If often checking for an item in a collection <code>Any</code> and <code>Contains</code> from <code>List&lt;T&gt;</code> can be slow.
<div class="highlight"><pre><span></span><code><span class="kt">var</span><span class="w"> </span><span class="n">userIds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Enumerable</span><span class="p">.</span><span class="n">Range</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="n">_000</span><span class="p">).</span><span class="n">ToList</span><span class="p">();</span>
<span class="n">usersIds</span><span class="p">.</span><span class="n">Any</span><span class="p">(</span><span class="n">u</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">999</span><span class="p">);</span><span class="w"> </span><span class="c1">// Basically goes through 999 elements</span>
<span class="n">userIds</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="m">999</span><span class="p">);</span><span class="w"> </span><span class="c1">// Faster than Any but still slower than HashSet</span>
</code></pre></div></p>
<p>✅ <strong>Good</strong> <code>HashSet</code> performs faster for set-based operations.
<div class="highlight"><pre><span></span><code><span class="kt">var</span><span class="w"> </span><span class="n">userIds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Enumerable</span><span class="p">.</span><span class="n">Range</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="n">_000</span><span class="p">).</span><span class="n">ToHashSet</span><span class="p">();</span>
<span class="n">userIds</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="m">999</span><span class="p">);</span>
</code></pre></div></p>
<h3 id="benchmark_1">Benchmark<a class="headerlink" href="#benchmark_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ListVsHashSet</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="n">_000</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Enumerable</span><span class="p">.</span><span class="n">Range</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">Count</span><span class="p">).</span><span class="n">ToList</span><span class="p">();</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">_hashSet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Enumerable</span><span class="p">.</span><span class="n">Range</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">Count</span><span class="p">).</span><span class="n">ToHashSet</span><span class="p">();</span>

<span class="w">    </span><span class="na">[Benchmark(Baseline = true)]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">ListContains</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">_list</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">Count</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">);</span>

<span class="w">    </span><span class="na">[Benchmark]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">ListAny</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">_list</span><span class="p">.</span><span class="n">Any</span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Count</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">);</span>

<span class="w">    </span><span class="na">[Benchmark]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">HashSetContains</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">_hashSet</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">Count</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>Results:
<div class="highlight"><pre><span></span><code><span class="o">|</span><span class="w">          </span><span class="n">Method</span><span class="w"> </span><span class="o">|</span><span class="w">          </span><span class="n">Mean</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="n">Error</span><span class="w"> </span><span class="o">|</span><span class="w">        </span><span class="n">StdDev</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="n">Ratio</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">RatioSD</span><span class="w"> </span><span class="o">|</span>
<span class="o">|----------------</span><span class="w"> </span><span class="o">|--------------</span><span class="p">:</span><span class="o">|--------------</span><span class="p">:</span><span class="o">|--------------</span><span class="p">:</span><span class="o">|-------</span><span class="p">:</span><span class="o">|--------</span><span class="p">:</span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="n">ListContains</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="m">1</span><span class="p">,</span><span class="m">279.002</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="m">10.5561</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="m">9.3577</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="m">1.000</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="m">0.00</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w">         </span><span class="n">ListAny</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">92</span><span class="p">,</span><span class="m">892.521</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="m">848.0088</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="m">379.1886</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">75.344</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="m">2.48</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">HashSetContains</span><span class="w"> </span><span class="o">|</span><span class="w">      </span><span class="m">5.019</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="m">0.1364</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="m">0.1401</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="m">0.004</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="m">0.00</span><span class="w"> </span><span class="o">|</span>
</code></pre></div></p>
<h2 id="use-hashset-for-set-based-operations-like-finding-the-intersection-of-two-collections">Use <code>HashSet</code> for set based operations like finding the intersection of two collections<a class="headerlink" href="#use-hashset-for-set-based-operations-like-finding-the-intersection-of-two-collections" title="Permanent link">&para;</a></h2>
<p>When performing set based operations like finding the intersection or union of two collection <code>HashSet</code> can be superior to a <code>List</code>.
Be aware that the API is a bit different with a <code>HashSet</code> as the <code>HashSet</code> is not pure and modifies the <code>HashSet</code> on which the operation is called on.</p>
<p>❌ <strong>Bad</strong> Using LINQ and <code>List&lt;T&gt;</code> to find the intersection of two collectionss 
<div class="highlight"><pre><span></span><code><span class="kt">var</span><span class="w"> </span><span class="n">evenNumbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Enumerable</span><span class="p">.</span><span class="n">Range</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="n">_000</span><span class="p">).</span><span class="n">Where</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">).</span><span class="n">ToList</span><span class="p">();</span>
<span class="kt">var</span><span class="w"> </span><span class="n">dividableByThree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Enumerable</span><span class="p">.</span><span class="n">Range</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="n">_000</span><span class="p">).</span><span class="n">Where</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">).</span><span class="n">ToList</span><span class="p">();</span>

<span class="kt">var</span><span class="w"> </span><span class="n">evenNumbersDividableByThree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evenNumbers</span><span class="p">.</span><span class="n">Intersect</span><span class="p">(</span><span class="n">dividableByThree</span><span class="p">).</span><span class="n">ToList</span><span class="p">();</span>
</code></pre></div></p>
<p>✅ <strong>Good</strong> Using a <code>HashSet</code> to find the intersection of two collections.
<div class="highlight"><pre><span></span><code><span class="kt">var</span><span class="w"> </span><span class="n">evenNumbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Enumerable</span><span class="p">.</span><span class="n">Range</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="n">_000</span><span class="p">).</span><span class="n">Where</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">).</span><span class="n">ToHashSet</span><span class="p">();</span>
<span class="kt">var</span><span class="w"> </span><span class="n">dividableByThree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Enumerable</span><span class="p">.</span><span class="n">Range</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="n">_000</span><span class="p">).</span><span class="n">Where</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">).</span><span class="n">ToHashSet</span><span class="p">();</span>

<span class="kt">var</span><span class="w"> </span><span class="n">evenNumbersDividableByThree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="p">(</span><span class="n">evenNumbers</span><span class="p">);</span>
<span class="n">evenNumbersDividableByThree</span><span class="p">.</span><span class="n">IntersectWith</span><span class="p">(</span><span class="n">dividableByThree</span><span class="p">);</span>
</code></pre></div></p>
<h3 id="benchmark_2">Benchmark<a class="headerlink" href="#benchmark_2" title="Permanent link">&para;</a></h3>
<p>Runtimes for the given example above:</p>
<p>Result:
<div class="highlight"><pre><span></span><code><span class="o">|</span><span class="w">              </span><span class="n">Method</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="n">Mean</span><span class="w"> </span><span class="o">|</span><span class="w">    </span><span class="n">Error</span><span class="w"> </span><span class="o">|</span><span class="w">   </span><span class="n">StdDev</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Ratio</span><span class="w"> </span><span class="o">|</span>
<span class="o">|--------------------</span><span class="w"> </span><span class="o">|---------</span><span class="p">:</span><span class="o">|---------</span><span class="p">:</span><span class="o">|---------</span><span class="p">:</span><span class="o">|------</span><span class="p">:</span><span class="o">|</span>
<span class="o">|</span><span class="w">    </span><span class="n">InterSectionList</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">25.69</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">0.416</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">0.369</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="m">1.00</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">InterSectionHashSet</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">11.88</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">0.108</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="m">0.090</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="m">0.46</span><span class="w"> </span><span class="o">|</span>
</code></pre></div></p>
<h2 id="use-arraysegmentt-for-efficient-slicing-of-arrays">Use <code>ArraySegment&lt;T&gt;</code> for efficient slicing of arrays<a class="headerlink" href="#use-arraysegmentt-for-efficient-slicing-of-arrays" title="Permanent link">&para;</a></h2>
<p>When slicing an array a new array is created. This is especially expensive when the array is large. <code>ArraySegment&lt;T&gt;</code> is a struct that holds a reference to the original array and the start and end index of the slice. This is much more efficient than creating a new one. Be aware that the <code>ArraySegment&lt;T&gt;</code> is a read-only view of the original array and any changes to the original array will be reflected in the <code>ArraySegment&lt;T&gt;</code>.</p>
<p>❌ <strong>Bad</strong> We create a new array when taking a slice of the original array, leading to extra memory allocations. 
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="nf">Slice</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="n">count</span><span class="p">];</span>
<span class="w">    </span><span class="n">Array</span><span class="p">.</span><span class="n">Copy</span><span class="p">(</span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">var</span><span class="w"> </span><span class="n">originalArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="p">};</span>
<span class="kt">var</span><span class="w"> </span><span class="n">slicedArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Slice</span><span class="p">(</span><span class="n">originalArray</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">);</span><span class="w"> </span><span class="c1">// Creates a new array { 2, 3, 4 }</span>
</code></pre></div></p>
<p>✅ <strong>Good</strong> Use <code>ArraySegment&lt;T&gt;</code> to create a view of the original array without creating a new array, avoiding the extra memory allocation.
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="n">ArraySegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Slice</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArraySegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">var</span><span class="w"> </span><span class="n">originalArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="p">};</span>
<span class="kt">var</span><span class="w"> </span><span class="n">slicedArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Slice</span><span class="p">(</span><span class="n">originalArray</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">);</span><span class="w"> </span><span class="c1">// A view over { 2, 3, 4 } in the original array</span>
</code></pre></div></p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2022 <a href="https://github.com/linkdotnet">Steven Giesel</a>.
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://www.linkedin.com/in/steven-giesel/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://github.com/linkdotnet" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://steven-giesel.com/" target="_blank" rel="noopener" title="steven-giesel.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M0 64c0-17.7 14.3-32 32-32 229.8 0 416 186.2 416 416 0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96 14.3 96 0 81.7 0 64zm128 352c0 35.3-28.7 64-64 64S0 451.3 0 416s28.7-64 64-64 64 28.7 64 64zM32 160c159.1 0 288 128.9 288 288 0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224-17.7 0-32-14.3-32-32s14.3-32 32-32z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.51d95adb.min.js"></script>
      
    
  </body>
</html>